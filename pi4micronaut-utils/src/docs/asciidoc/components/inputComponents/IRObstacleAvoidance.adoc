:imagesdir: img/

ifndef::rootpath[]
:rootpath: ../../
endif::rootpath[]

ifdef::rootpath[]
:imagesdir: {rootpath}{imagesdir}
endif::rootpath[]

==== IR Obstacle Avoidance Sensor
[.text-right]
https://github.com/oss-slu/Pi4Micronaut/edit/develop/pi4micronaut-utils/src/docs/asciidoc/components/inputComponents/irObstacleAvoidanceSensor.adoc[Improve this doc]

===== Overview
This section provides the details of the IR Obstacle Avoidance Sensor, including its components, assembly instructions, and functionality.

The IR (Infrared) Obstacle Avoidance Module is a proximity sensor that detects objects and obstacles within a short distance (2-30cm) using infrared reflection. It is commonly used in robotics for collision avoidance, object detection, and boundary sensing. The module features adjustable sensitivity via a potentiometer, digital output for easy integration, fast response time, low power consumption, and operates on 3.3V to 5V power supplies.

===== Components
* 1 x Raspberry Pi (Pi 3, 4, or Zero recommended)
* 1 x IR Obstacle Avoidance Module
* 3 x Jumper Wires (Female-to-Male or appropriate connectors)
* 1 x Breadboard (optional, for prototyping)
* Power supply for Raspberry Pi

===== Assembly Instructions
* Place the IR Obstacle Avoidance Module onto the breadboard or connect directly to the Raspberry Pi.
* Connect the **VCC** pin of the IR module to **5V** on the Raspberry Pi (Physical Pin 2 or 4).
* Connect the **GND** pin of the IR module to **Ground** on the Raspberry Pi (Physical Pin 6, 9, 14, 20, 25, 30, 34, or 39).
* Connect the **OUT** (or **DO**) pin of the IR module to **GPIO 17** on the Raspberry Pi (Physical Pin 11).
* Verify connections to ensure no loose wires or short circuits.
* Adjust the potentiometer (small blue or orange screw) to set detection sensitivity:
  - Turn **clockwise** to increase sensitivity (detect closer objects).
  - Turn **counter-clockwise** to decrease sensitivity (detect farther objects).

> **Tip**: Use 5V for better detection range and performance, though 3.3V is supported. Ensure the module's IR LEDs face forward.

===== Circuit Diagram
image::irObstacleAvoidance-CD.png.png[]

===== Schematic Diagram
image::irObstacleAvoidance-SD.png[]

===== Functionality
The IR Obstacle Avoidance Module uses active infrared light reflection to detect obstacles. It emits infrared light via an onboard LED, which reflects off nearby objects and is detected by the IR receiver. The onboard comparator circuit processes the signal and outputs a digital signal (LOW when an obstacle is detected, HIGH when the path is clear). The detection range (2-30cm) is adjustable via the potentiometer, making it suitable for real-time robotics applications.

===== Testing
Use the following commands to test the component:

[source, bash]
----
$curl http://localhost:8080/irObstacleAvoidance/isObstacleDetected
----
* `/isObstacleDetected` - Returns `true` if an obstacle is detected, `false` if the path is clear.

[source, bash]
----
$curl http://localhost:8080/irObstacleAvoidance/getState
----
* `/getState` - Returns the raw digital state (`HIGH` or `LOW`).

[source, bash]
----
$curl http://localhost:8080/irObstacleAvoidance/getStatusMessage
----
* `/getStatusMessage` - Returns a human-readable status (`"Obstacle detected"` or `"No obstacle"`).

===== Troubleshooting
**Sensor Always Reports Obstacle Detected**:
* Adjust potentiometer counter-clockwise to decrease sensitivity.
* Ensure the module is not facing a reflective surface.
* Verify VCC is connected to 5V, not 3.3V.
* Test with a white object to confirm detection.
* Check GPIO state with `gpio readall`.

**Sensor Never Detects Obstacles**:
* Adjust potentiometer clockwise to increase sensitivity.
* Verify OUT pin is connected to GPIO 17.
* Confirm `application.yml` has the correct GPIO address.
* Test with a reflective object (e.g., white or shiny surface).
* Measure OUT pin voltage with a multimeter (should switch between 0V and 5V).

**Inconsistent Detection**:
* Increase debounce time in `application.yml` to 20000 (20ms).
* Secure all jumper wires.
* Shield from sunlight or other IR sources.
* Mount the module rigidly to prevent vibration.
* Add a 100ÂµF capacitor across VCC and GND near the module.

**Module Won't Power On**:
* Verify 5V at VCC with a multimeter.
* Check GND connections.
* Ensure `application.yml` is correctly configured.
* Test GPIO manually with `gpio mode 17 in` and `gpio read 17`.

**Application Crashes**:
* Verify `application.yml` syntax and `ir-obstacle-input` key.
* Ensure `@Named("ir-obstacle-input")` matches the configuration.
* Rebuild with `./gradlew clean build`.
* Check logs for configuration errors.

===== YAML Configuration
The IR Obstacle Avoidance Sensor configuration as it appears in the YAML file:

[source, yaml]
----
pi4j:
  digital-input:
    ir-obstacle-input:
      name: IR Obstacle Avoidance Sensor
      address: 17
      pull: PULL_UP
      debounce: 10000
      provider: pigpio-digital-input
----

===== Constructor and Methods
To see the constructor and methods of the `IRObstacleAvoidance` class, refer to the JavaDoc: link:https://oss-slu.github.io/Pi4Micronaut/javadoc/com/opensourcewithslu/inputdevices/IRObstacleAvoidance.html[IRObstacleAvoidance JavaDoc]

===== Example Controller
This controller demonstrates the usage of the IR Obstacle Avoidance Sensor:

[source, java]
----
include::../../../../../../components/src/main/java/com/opensourcewithslu/components/controllers/IRObstacleAvoidanceController.java[tag=ex]
----